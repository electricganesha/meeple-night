// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider = "postgresql"
  extensions = [pg_trgm]
}

model User {
  id            String    @id
  name          String
  email         String
  emailVerified Boolean   @default(false)
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  sessions      Session[]
  accounts      Account[]
  collection    BoardGame[] @relation(name: "UserCollection")

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}
model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

model BoardGame {
  id        Int     @id @default(autoincrement())
  bggId     Int     @unique
  name      String
  description String? @db.Text 
  
  yearPublished Int?
  gameWeight    Float?  // "GameWeight"
  avgRating     Float?  // "AvgRating"
  bayesAvgRating Float? // "BayesAvgRating"
  stdDev        Float?
  
  minPlayers    Int?
  maxPlayers    Int?
  
  comAgeRec     Float?  
  languageEase  Float? 
  
  bestPlayers   String? 
  goodPlayers   String? 
  
  numOwned      Int?
  numWant       Int?
  numWish       Int?
  numWeightVotes Int?
  
  mfgPlaytime    Int?
  comMinPlaytime Int?
  comMaxPlaytime Int?
  mfgAgeRec      Int?
  
  numUserRatings Int?
  numComments    Int?
  
  numAlternates      Int?
  numExpansions      Int?
  numImplementations Int?
  
  isReimplementation Boolean @default(false)
  
  family        String?  @db.Text
  kickstarted   Boolean  @default(false)
  
  imagePath     String?
  
  rankBoardgame    Int?
  rankStrategy     Int?
  rankAbstract     Int?
  rankFamily       Int?
  rankThematic     Int?
  rankCGS          Int?
  rankWargames     Int?
  rankParty        Int?
  rankChildrens    Int?
  
  catThematic  Boolean @default(false)
  catStrategy  Boolean @default(false)
  catWar       Boolean @default(false)
  catFamily    Boolean @default(false)
  catCGS       Boolean @default(false)
  catAbstract  Boolean @default(false)
  catParty     Boolean @default(false)
  catChildrens Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  owners User[] @relation(name: "UserCollection")

  @@index([name(ops: raw("gin_trgm_ops"))], type: Gin)  
  @@index([bggId])
}
